# name: CI/CD Frontend & Backend to DO Droplet

# on:
#   push:
#     branches:
#       - main
#   # You can add pull_request here for CI-only checks

# jobs:
#   frontend:
#     name: Frontend CI/CD
#     runs-on: ubuntu-24.04

#     defaults:
#       run:
#         working-directory: ./frontend

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       - name: Use Node
#         uses: actions/setup-node@v4
#         with:
#           node-version: '20'
#           cache: 'npm'
#           cache-dependency-path: frontend/package-lock.json

#       - name: Install dependencies
#         run: npm ci

#       - name: Build frontend
#         run: npm run build

#       # Optional tests
#       # - name: Test frontend
#       #   run: npm test -- --watch=false

#       - name: Deploy frontend to Droplet
#         if: github.ref == 'refs/heads/main'
#         run: |
#           chmod +x ./deploy-frontend.sh
#           ./deploy-frontend.sh
#         working-directory: ./
#         env:
#           SSH_HOST: ${{ secrets.SSH_HOST }}
#           SSH_USER: ${{ secrets.SSH_USER }}
#           SSH_KEY: ${{ secrets.SSH_KEY }}

#   backend:
#     name: Backend CI/CD
#     runs-on: ubuntu-latest
#     needs: frontend

#     defaults:
#       run:
#         working-directory: ./backend

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       - name: Use Node
#         uses: actions/setup-node@v4
#         with:
#           node-version: '20'
#           cache: 'npm'
#           cache-dependency-path: backend/package-lock.json

#       - name: Install dependencies
#         run: npm ci

#       - name: Build backend
#         run: npm run build

#       # Optional tests
#       # - name: Test backend
#       #   run: npm test

#       - name: Deploy backend to Droplet
#         if: github.ref == 'refs/heads/main'
#         run: |
#           chmod +x ./deploy-backend.sh
#           ./deploy-backend.sh
#         working-directory: ./
#         env:
#           SSH_HOST: ${{ secrets.SSH_HOST }}
#           SSH_USER: ${{ secrets.SSH_USER }}
#           SSH_KEY: ${{ secrets.SSH_KEY }}


name: Build on PR approval

on:
  pull_request_review:
    types: [submitted]

jobs:
  build:
    # Run only when the review is APPROVED and the PR targets main
    if: >
      github.event.review.state == 'approved' &&
      github.event.pull_request.base.ref == 'main'

    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20   # change if your project uses another version

      - name: Install dependencies
        run: npm install
        # or: npm ci

      - name: Build project
        run: npm run build
